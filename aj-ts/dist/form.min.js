"use strict";Vue.component("aj-form-between-date",{template:'\n        <form action="." method="GET" class="dateRange" @submit="valid">\n            <aj-form-calendar-input :date-only="true" :position-fixed="true" placeholder="起始时间" field-name="startDate" ></aj-form-calendar-input>\n            - <aj-form-calendar-input :date-only="true" :position-fixed="true" placeholder="截至时间" field-name="endDate"></aj-form-calendar-input>\n            <button class="aj-btn">按时间筛选</button>\n        </form>    \n    ',props:{isAjax:{type:Boolean,default:!0}},methods:{valid:function(e){var t,i=this.$el.$("input[name=startDate]").value,a=this.$el.$("input[name=endDate]").value;return i&&a?new Date(i)>new Date(a)?(aj.alert("起始日期不能晚于结束日期"),void e.preventDefault()):void(this.isAjax&&(e.preventDefault(),t=this.$parent.$parent,aj.apply(t.$refs.pager.extraParam,{startDate:i,endDate:a}),t.reload())):(aj.alert("输入数据不能为空"),void e.preventDefault())}}}),Vue.component("aj-form-calendar-input",{template:'\n        <div class="aj-form-calendar-input" :class="{\'show-time\': showTime}" @mouseover="onMouseOver">\n            <div class="icon fa fa-calendar"></div>\n            <input :placeholder="placeholder" size="12" :name="fieldName" :value="date + (dateOnly ? \'\' : \' \' + time)" type="text" autocomplete="off"/>\n            <aj-form-calendar ref="calendar" :show-time="showTime" @pick-date="recEvent" @pick-time="recTimeEvent">\n            </aj-form-calendar>\n        </div>\n    ',data:function(){return{date:this.fieldValue,time:""}},props:{fieldName:{type:String,required:!0},fieldValue:{type:String,required:!1,default:""},dateOnly:{type:Boolean,required:!1,default:!0},showTime:!1,positionFixed:Boolean,placeholder:{type:String,default:"请输入日期"}},watch:{fieldValue:function(e){this.date=e}},mounted:function(){var e;this.positionFixed&&this.$el.$(".aj-form-calendar").classList.add("positionFixed"),this.fieldValue&&((e=this.fieldValue.split(" ")[0]).split("-"),this.$refs.calendar.date=new Date(e[0],e[1]-1,e[2]," ",""," "))},methods:{recTimeEvent:function(e){this.time=e},recEvent:function(e){this.date=e.trim()},onMouseOver:function(e){var t,i;this.positionFixed&&(i=(t=e.currentTarget).getBoundingClientRect(),(e=this.$el.$(".aj-form-calendar")).style.top=+(i.top+t.clientHeight)+"px",e.style.left=+i.left+0+"px")}}});var aj,__makeTemplateObject=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};Vue.component("aj-form-calendar",{template:html(__makeTemplateObject(['\n        <div class="aj-form-calendar">\n            <div class="selectYearMonth">\n                <a href="###" @click="getDate(\'preYear\')" class="preYear" title="上一年">&lt;</a> \n                <select @change="setMonth" v-model="month">\n                    <option value="1">一月</option><option value="2">二月</option><option value="3">三月</option><option value="4">四月</option>\n                    <option value="5">五月</option><option value="6">六月</option><option value="7">七月</option><option value="8">八月</option>\n                    <option value="9">九月</option><option value="10">十月</option><option value="11">十一月</option><option value="12">十二月</option>\n                </select>\n                <a href="###" @click="getDate(\'nextYear\')" class="nextYear" title="下一年">&gt;</a>\n            </div>\n            <div class="showCurrentYearMonth">\n                <span class="showYear">{{year}}</span>/<span class="showMonth">{{month}}</span>\n            </div>\n            <table>\n                <thead>\n                    <tr><td>日</td><td>一</td><td>二</td><td>三</td><td>四</td><td>五</td><td>六</td></tr>\n                </thead>\n                <tbody @click="pickDay"></tbody>\n            </table>\n            <div v-if="showTime" class="showTime">\n                时 <select class="hour aj-select"><option v-for="n in 24">{{n}}</option></select>\n                分 <select class="minute aj-select"><option v-for="n in 61">{{n - 1}}</option></select>\n                <a href="#" @click="pickupTime">选择时间</a>\n            </div>\n        </div>    \n    '],['\n        <div class="aj-form-calendar">\n            <div class="selectYearMonth">\n                <a href="###" @click="getDate(\'preYear\')" class="preYear" title="上一年">&lt;</a> \n                <select @change="setMonth" v-model="month">\n                    <option value="1">一月</option><option value="2">二月</option><option value="3">三月</option><option value="4">四月</option>\n                    <option value="5">五月</option><option value="6">六月</option><option value="7">七月</option><option value="8">八月</option>\n                    <option value="9">九月</option><option value="10">十月</option><option value="11">十一月</option><option value="12">十二月</option>\n                </select>\n                <a href="###" @click="getDate(\'nextYear\')" class="nextYear" title="下一年">&gt;</a>\n            </div>\n            <div class="showCurrentYearMonth">\n                <span class="showYear">{{year}}</span>/<span class="showMonth">{{month}}</span>\n            </div>\n            <table>\n                <thead>\n                    <tr><td>日</td><td>一</td><td>二</td><td>三</td><td>四</td><td>五</td><td>六</td></tr>\n                </thead>\n                <tbody @click="pickDay"></tbody>\n            </table>\n            <div v-if="showTime" class="showTime">\n                时 <select class="hour aj-select"><option v-for="n in 24">{{n}}</option></select>\n                分 <select class="minute aj-select"><option v-for="n in 61">{{n - 1}}</option></select>\n                <a href="#" @click="pickupTime">选择时间</a>\n            </div>\n        </div>    \n    '])),data:function(){var e=new Date;return{date:e,year:e.getFullYear(),month:e.getMonth()+1,day:1}},props:{showTime:!1},mounted:function(){this.$options.watch.date.call(this)},watch:{date:function(){this.year=this.date.getFullYear(),this.month=this.date.getMonth()+1,this.render()}},methods:{render:function(){for(var e=this.getDateArr(),t=document.createDocumentFragment();e.length;){for(var i=document.createElement("tr"),a=1;a<=7;a++){var n,o,l=document.createElement("td");!e.length||(o=e.shift())&&(l.innerHTML=o+"",n=this.year+"-"+this.month+"-"+o,l.className="day day_"+n,l.title=n,o=new Date(this.year,this.month-1,o),this.isSameDay(o,this.date)&&(l.classList.add("onToday"),this.onToday&&this.onToday(l))),i.appendChild(l)}t.appendChild(i)}var r=this.$el.$("table tbody");r.innerHTML="",r.appendChild(t)},getDate:function(e,t){var i=this.date.getFullYear(),a=this.date.getMonth()+1;switch(e){case"preMonth":this.date=new Date(i,a-2,1);break;case"nextMonth":this.date=new Date(i,a,1);break;case"setMonth":this.date=new Date(i,t-1,1);break;case"preYear":this.date=new Date(i-1,a-1,1);break;case"nextYear":this.date=new Date(i+1,a-1,1)}},setMonth:function(e){e=e.target;this.getDate("setMonth",Number(e.selectedOptions[0].value))},getDateArr:function(){for(var e=[],t=1,i=new Date(this.year,this.month-1,1).getDay();t<=i;t++)e.push(0);for(var t=1,a=new Date(this.year,this.month,0).getDate();t<=a;t++)e.push(t);return e},pickDay:function(e){e=e.target.title;return this.$emit("pick-date",e),e},pickupTime:function(e){var t=this.$el.$(".hour"),i=this.$el.$(".minute"),i=t.selectedOptions[0].value+":"+i.selectedOptions[0].value;this.$emit("pick-time",i)},isSameDay:function(e,t){return e.getFullYear()==t.getFullYear()&&e.getMonth()==t.getMonth()&&e.getDate()==t.getDate()}}}),Vue.component("aj-china-area",{template:'\n\t\t<div class="aj-china-area">\n\t\t\t<span>省</span> \n\t\t\t<select v-model="province" class="aj-select" style="width:120px;" :name="provinceName || \'locationProvince\'">\n\t\t\t\t<option value="">请选择</option>\n\t\t\t\t<option v-for="(v, k) in addressData[86]" :value="k">{{v}}</option>\n\t\t\t</select>\n\t\t\t<span>市 </span>\n\t\t\t<select v-model="city" class="aj-select" style="width:120px;" :name="cityName || \'locationCity\'">\n\t\t\t\t<option value="">请选择</option>\n\t\t\t\t<option v-for="(v, k) in citys" :value="k">{{v}}</option>\n\t\t\t</select>\n\t\t\t<span>区</span>  \n\t\t\t<select v-model="district" class="aj-select" style="width:120px;" :name="districtName || \'locationDistrict\'">\n\t\t\t\t<option value="">请选择</option>\n\t\t\t\t<option v-for="(v, k) in districts" :value="k">{{v}}</option>\n\t\t\t</select>\n\t\t</div>\n\t',props:{provinceCode:String,cityCode:String,districtCode:String,provinceName:String,cityName:String,districtName:String},data:function(){if(!window.China_AREA)throw"中国行政区域数据 脚本没导入";return{province:this.provinceCode||"",city:this.cityCode||"",district:this.districtCode||"",addressData:window.China_AREA}},watch:{province:function(e,t){}},computed:{citys:function(){if(this.province)return this.addressData[this.province]},districts:function(){if(this.city)return this.addressData[this.city]}}}),function(a){var e;(e=a.form||(a.form={})).EditForm||(e.EditForm={}),Vue.component("aj-edit-form",{template:'\n            <form class="aj-table-form" :action="getInfoApi + (isCreate ? \'\' : info.id + \'/\')" :method="isCreate ? \'POST\' : \'PUT\'">\n                <h3>{{isCreate ? "新建" : "编辑" }}{{uiName}}</h3>\n                \x3c!-- 传送 id 参数 --\x3e\n                <input v-if="!isCreate" type="hidden" name="id" :value="info.id" />\n                <slot v-bind:info="info"></slot>\n                <div class="aj-btnsHolder">\n                    <button><img :src="ajResources.commonAsset + \'/icon/save.gif\'" /> {{isCreate ? "新建":"保存"}}</button>\n                    <button onclick="this.up(\'form\').reset();return false;">复 位</button>\n                    <button v-if="!isCreate" v-on:click.prevent="del()">\n                        <img :src="ajResources.commonAsset + \'/icon/delete.gif\'" /> 删 除\n                    </button>\n                    <button @click.prevent="close">关闭</button>\n                </div>\n            </form>\n        ',props:{isCreate:Boolean,uiName:String,apiUrl:{type:String,required:!0}},data:function(){return{id:0,info:{}}},mounted:function(){var i=this;a.xhr.form(this.$el,function(e){var t;e&&(e.isOk?(t=(i.isCreate?"新建":"保存")+i.uiName+"成功",a.msg.show(t),i.$parent.close()):a.msg.show(e.msg))},{beforeSubmit:function(e,t){return!0}})},methods:{load:function(e,t){var i=this;this.id=e,a.xhr.get(this.apiUrl+e+"/",function(e){i.info=e.result,t&&t(e)})},close:function(){"aj-layer"===this.$parent.$options._componentTag?this.$parent.close():history.back()},del:function(){var e=a.form.utils.getFormFieldValue(this.$el,"input[name=id]"),t=a.form.utils.getFormFieldValue(this.$el,"input[name=name]");a.showConfirm("请确定删除记录：\n"+t+"？",function(){return a.xhr.dele("../"+e+"/",function(e){e.isOk?a.msg.show("删除成功！"):a.alert("删除失败！")})})}}})}(aj=aj||{}),function(){function e(t){this.toolbarEl.$("i",function(e){-1==e.className.indexOf("switchMode")&&(e.style.color=t?"lightgray":"")})}Vue.component("aj-form-html-editor",{template:'\n            <div class="aj-form-html-editor">\n                <ul class="toolbar" @click="onToolBarClk">\n                    <li class="dorpdown">\n                        <i title="字体"         class="fa-font"></i>\n                        <div class="fontfamilyChoser" @click="onFontfamilyChoserClk">\n                            <a style="font-family: \'宋体\'">宋体</a>\n                            <a style="font-family: \'黑体\'">黑体</a>\n                            <a style="font-family: \'楷体\'">楷体</a>\n                            <a style="font-family: \'隶书\'">隶书</a>\n                            <a style="font-family: \'幼圆\'">幼圆</a>\n                            <a style="font-family: \'Microsoft YaHei\'">Microsoft YaHei</a>\n                            <a style="font-family: Arial">Arial</a>\n                            <a style="font-family: \'Arial Narrow\'">Arial Narrow</a>\n                            <a style="font-family: \'Arial Black\'">Arial Black</a>\n                            <a style="font-family: \'Comic Sans MS\'">Comic Sans MS</a>\n                            <a style="font-family: Courier">Courier</a>\n                            <a style="font-family: System">System</a>\n                            <a style="font-family: \'Times New Roman\'">Times New Roman</a>\n                            <a style="font-family: Verdana">Verdana</a>\n                        </div>\n                    </li>\t\t\n                    <li class="dorpdown">\n                        <i title="字号"         class="fa-header"></i>\n                        <div class="fontsizeChoser" @click="onFontsizeChoserClk">\n                            <a style="font-size: xx-small; ">极小</a>\n                            <a style="font-size: x-small;  ">特小</a>\n                            <a style="font-size: small;    ">小</a>\n                            <a style="font-size: medium;   ">中</a>\n                            <a style="font-size: large;    ">大</a>\n                            <a style="font-size: x-large;  ">特大</a>\n                            <a style="font-size: xx-large; line-height: 140%">极大</a>\n                        </div>\n                    </li>\t\t\n                    <li><i title="加粗"         class="bold fa-bold"></i></li>\t\t\n                    <li><i title="斜体"         class="italic fa-italic"></i></li>\t\t\n                    <li><i title="下划线"       class="underline fa-underline"></i></li>\n                    <li><i title="左对齐"       class="justifyleft fa-align-left"></i></li>\n                    <li><i title="中间对齐"     class="justifycenter fa-align-center"></i></li>\n                    <li><i title="右对齐"       class="justifyright fa-align-right"></i></li>\n                    <li><i title="数字编号"     class="insertorderedlist fa-list-ol"></i></li>\n                    <li><i title="项目编号"     class="insertunorderedlist fa-list-ul"></i></li>\n                    <li><i title="增加缩进"     class="outdent fa-outdent"></i></li>\n                    <li><i title="减少缩进"     class="indent fa-indent"></i></li>\n                    <li class="dorpdown">\n                        <i title="字体颜色"     class="fa-paint-brush"></i>\n                        <div class="fontColor colorPicker" v-html="createColorPickerHTML()" @click="onFontColorPicker"></div>\n                    </li>\n                    <li class="dorpdown">\n                        <i title="背景颜色"     class="fa-pencil" ></i>\n                        <div class="bgColor colorPicker" v-html="createColorPickerHTML()" @click="onFontBgColorPicker"></div>\n                    </li>\n                    <li><i title="增加链接"     class="createLink fa-link" ></i></li>\n                    <li><i title="增加图片"     class="insertImage fa-file-image-o" ></i></li>\n                    <li><i title="一键存图"     class="saveRemoteImage2Local fa-hdd-o"></i></li>\n                    <li><i title="清理 HTML"    class="cleanHTML fa-eraser" ></i></li>\n                    <li><i title="切换到代码"   class="switchMode fa-code"></i></li>\n                </ul>\n\n                <div class="editorBody">\t\n                    <iframe srcdoc="<html><body></body></html>"></iframe>   \n                    <slot></slot>\n                </div>\n            </div>\n        ',props:{fieldName:{type:String,required:!0},content:{type:String,required:!1},basePath:{type:String,required:!1,default:""},uploadImageActionUrl:String},mounted:function(){var t=this,e=this.$el;this.iframeEl=e.$("iframe"),this.sourceEditor=e.$("textarea"),this.iframeWin=this.iframeEl.contentWindow,this.mode="iframe",this.toolbarEl=e.$(".toolbar"),this.iframeWin.onload=function(e){t.iframeDoc=t.iframeWin.document,t.iframeDoc.designMode="on",t.sourceEditor.value&&t.setValue(t.sourceEditor.value),t.iframeDoc.addEventListener("paste",function(e){var t=this;if(!this.uploadImageActionUrl)return void aj.alert("未提供图片上传地址");var i=e.clipboardData&&e.clipboardData.items,a=null;if(i&&i.length)for(var n=0;n<i.length;n++){var o=i[n];if(-1!==o.type.indexOf("image")){if(window.isCreate)return void aj.alert("请保存记录后再上传图片。");a=o.getAsFile();break}}a&&(e.preventDefault(),aj.img.changeBlobImageQuality(a,function(e){Vue.options.components["aj-xhr-upload"].extendOptions.methods.doUpload.call({action:t.uploadImageActionUrl,progress:0,uploadOk_callback:function(e){e.isOk&&this.format("insertImage",this.ajResources.imgPerfix+e.imgUrl)},$blob:e,$fileName:"foo.jpg"})}))}.bind(t))}},methods:{onToolBarClk:function(e){var t=this,i=e.target.className.split(" ").shift();switch(i){case"createLink":var a=prompt("请输入 URL 地址");a&&this.format("createLink",a);break;case"insertImage":window.isCreate?aj.alert("请保存记录后再上传图片。"):App.$refs.uploadLayer.show(function(e){e&&e.isOk&&t.format("insertImage",e.fullUrl)});break;case"switchMode":this.setMode();break;case"cleanHTML":this.iframeDoc.body.innerHTML=HtmlSanitizer.SanitizeHtml(this.iframeDoc.body.innerHTML);break;case"saveRemoteImage2Local":(function(){for(var e=[],n=new Array,t=this.iframeDoc.querySelectorAll("img"),i=0,a=t.length;i<a;i++){var o=t[i],l=o.getAttribute("src");/^http/.test(l)&&(e.push(l),n.push(o))}e.length?aj.xhr.post("../downAllPics/",function(e){for(var t=e.pics,i=0,a=t.length;i<a;i++)n[i].src="images/"+t[i];aj.alert("所有图片下载完成。")},{pics:e.join("|")}):aj.alert("未发现有远程图片")}).call(this);break;default:this.format(i)}},format:function(e,t){t?this.iframeDoc.execCommand(e,!1,t):this.iframeDoc.execCommand(e,!1),this.iframeWin.focus()},insertEl:function(e){this.iframeDoc.body.innerHTML=e},setValue:function(e){var t=this;setTimeout(function(){t.iframeWin.document.body.innerHTML=e},500)},getValue:function(e,t){var i=this.iframeDoc.body.innerHTML;return e&&(i=i.replace(/<(\/)*(\\?xml:|meta|link|span|font|del|ins|st1:|[ovwxp]:)((.|\s)*?)>/gi,"").replace(/(class|style|type|start)=("(.*?)"|(\w*))/gi,"").replace(/<style(.*?)style>/gi,"").replace(/<script(.*?)script>/gi,"").replace(/<!--(.*?)-->/gi,"")),t&&(i=encodeURIComponent(i)),i},setMode:function(){"iframe"==this.mode?(this.iframeEl.classList.add("hide"),this.sourceEditor.classList.remove("hide"),this.sourceEditor.value=this.iframeDoc.body.innerHTML,this.mode="textarea",e.call(this,!0)):(this.iframeEl.classList.remove("hide"),this.sourceEditor.classList.add("hide"),this.iframeDoc.body.innerHTML=this.sourceEditor.value,this.mode="iframe",e.call(this,!1))},onFontfamilyChoserClk:function(e){e=e.target;this.format("fontname",e.innerHTML);var t=e.parentNode;t.style.display="none",setTimeout(function(){return t.style.display=""},300)},onFontsizeChoserClk:function(e){for(var t=e.target,i=e.currentTarget.children,a=0,n=i.length;a<n&&t!=i[a];a++);this.format("fontsize",a+"")},onFontColorPicker:function(e){this.format("foreColor",e.target.title)},onFontBgColorPicker:function(e){this.format("backColor",e.target.title)},createColorPickerHTML:function(){for(var e,t=["00","33","66","99","CC","FF"],i='<div class="colorhead"><span class="colortitle">颜色选择</span></div><div class="colorbody"><table cellspaci="0" cellpadding="0"><tr>',a=0;a<6;++a){i+='<td><table class="colorpanel" cellspacing="0" cellpadding="0">';for(var n=0,o=t[a];n<6;++n){i+="<tr>";for(var l=0,r=t[n];l<6;++l)i+='<td unselectable="on" style="background-color: '+(e="#"+o+t[l]+r)+(5==l&&2!=a&&5!=a?";border-right:none;":"")+(5==n&&a<3?";border-bottom:none":"")+'" title="'+e+'"></td>';i+="</tr>"}i+="</table></td>","66"==t[a]&&(i+="</tr><tr>")}return i+="</tr></table></div>"}}})}(),Vue.component("aj-form-popup-upload",{template:'\n        <aj-layer>\n            <h3>图片上传</h3>\n            <p>上传成功后自动插入到正文</p>\n            <aj-xhr-upload ref="uploadControl" :action="uploadUrl" :is-img-upload="true" :hidden-field="imgName"\n                :img-place="ajResources.commonAsset + \'/images/imgBg.png\'">\n            </aj-xhr-upload>\n            <div>上传限制：{{text.maxSize}}kb 或以下，分辨率：{{text.maxHeight}}x{{text.maxWidth}}</div>\n        </aj-layer>\n    ',data:function(){return{text:{}}},props:{uploadUrl:{type:String,required:!0},imgName:{type:String,required:!1},imgId:{type:Number,required:!1},imgPlace:String},mounted:function(){var e=this.$refs.uploadControl;this.text={maxSize:e.limitSize||600,maxHeight:e.imgMaxHeight,maxWidth:e.imgMaxWidth}},methods:{show:function(e){e&&(this.$refs.uploadControl.uploadOk_callback=e),this.$children[0].show()}}}),Vue.component("aj-form-select",{template:'\n        <select :name="name" class="aj-form-select">\n            <template v-for="value, key, index in options">\n                <option v-if="index === selectedIndex" selected :value="value" >{{key}}</option>\n                <option v-else :value="value" >{{key}}</option>\n            </template>\n        </select>\n    ',props:{name:{type:String,required:!0},options:{type:Object,required:!0},selectedIndex:{type:Number}}}),function(e){(e=(e=e.form||(e.form={})).utils||(e.utils={})).getFormFieldValue=function(e,t){if(e=e.$(t))return e.value;throw"找不到"+t+"元素"},e.selectOption=function(t){this.$el.$("option",function(e){console.log(e.value),e.value==t&&(e.selected=!0)})}}(aj=aj||{}),function(e){function r(e){if(e.disabled||"file"===e.type||"reset"===e.type||"submit"===e.type||"button"===e.type)return"";var t=e.validity;if(!t)return"浏览器不支持 HTML5 表单验证";if(t.valid)return"";if(t.valueMissing)return"该项是必填项";if(t.typeMismatch)return"email"===e.type?"请输入有效的邮件地址":"url"===e.type?"请输入一个有效的网址":"请输入正确的类型";if(t.tooShort)return"Please lengthen this text to "+e.getAttribute("minLength")+" characters or more. You are currently using "+e.value.length+" characters.";if(t.tooLong)return"Please shorten this text to no more than "+e.getAttribute("maxLength")+" characters. You are currently using "+e.value.length+" characters.";if(t.badInput)return"Please enter a number.";if(t.stepMismatch)return"Please select a valid value.";if(t.rangeOverflow)return"Please select a value that is no more than "+e.getAttribute("max")+".";if(t.rangeUnderflow)return"Please select a value that is no less than "+e.getAttribute("min")+".";if(t.patternMismatch){e=e.getAttribute("title");return e?e:"格式要求不正确"}return"The value you entered for this field is invalid."}function s(e,t,i){var a,n,o=e.id||e.name;o&&(e.classList.add("error"),(n=e.form.querySelector(".error-message#error-for-"+o))||((n=document.createElement("div")).className="error-message",n.id="error-for-"+o,null!==(a=e.parentNode)&&void 0!==a&&a.insertBefore(n,e.nextSibling)),e.setAttribute("aria-describedby","error-for-"+o),n.innerHTML=t,i||(n.style.display="inline-block"),n.style.visibility="visible")}function t(e){var i="true"===e.dataset.msgNewline;e.setAttribute("novalidate","true"),document.addEventListener("blur",function(e){var t=e.target,e=r(t);e?s(t,e,i):(t=(e=t).id||e.name)&&(e.classList.remove("error"),e.removeAttribute("aria-describedby"),(t=e.form.querySelector(".error-message#error-for-"+t))&&(t.innerHTML="",t.style.display="none",t.style.visibility="hidden"))},!0)}((e.form||(e.form={})).Validator=t).hasError=r,t.onSubmit=function(e){for(var t=e.elements,i=null,a=0,n=t.length;a<n;a++){var o,l=t[a];(o=r(l))&&(s(l,o),i=i||l)}return!i||(i.focus(),!1)}}(aj=aj||{}),function(){Vue.component("aj-xhr-upload",{template:'\n            <div class="aj-xhr-upload" :style="{display: buttonBottom ? \'inherit\': \'flex\'}">\n                <input v-if="hiddenField" type="hidden" :name="hiddenField" :value="hiddenFieldValue" />\n                <div v-if="isImgUpload">\n                    <a :href="imgPlace" target="_blank">\n                        <img class="upload_img_perview" :src="(isFileSize && isExtName && imgBase64Str) ? imgBase64Str : imgPlace" />\n                    </a>\n                </div>\n                <div class="pseudoFilePicker">\n                    <label :for="\'uploadInput_\' + radomId"><div><div>+</div>点击选择{{isImgUpload ? \'图片\': \'文件\'}}</div></label>\n                </div>\n                <input type="file" :name="fieldName" class="hide" :id="\'uploadInput_\' + radomId" \n                    @change="onUploadInputChange" :accept="isImgUpload ? \'image/*\' : accpectFileType" />\n                <div v-if="!isFileSize || !isExtName">{{errMsg}}</div>\n                <div v-if="isFileSize && isExtName">\n                    {{fileName}}<br />\n                    <button @click.prevent="doUpload" style="min-width:110px;">{{progress && progress !== 100 ? \'上传中 \' + progress + \'%\': \'上传\'}}</button>\n                </div>\n            </div>    \n        ',props:{action:{type:String,required:!0},fieldName:String,limitSize:Number,hiddenField:{type:String,default:null},hiddenFieldValue:String,limitFileType:String,accpectFileType:String,isImgUpload:Boolean,imgPlace:String,imgMaxWidth:{type:Number,default:1920},imgMaxHeight:{type:Number,default:1680},buttonBottom:Boolean},data:function(){var t=this;return{isFileSize:!1,isExtName:!1,isImgSize:!1,errMsg:null,newlyId:null,radomId:Math.round(1e3*Math.random()),uplodedFileUrl:null,uploadOk_callback:function(e){e.isOk&&(t.uplodedFileUrl=e.imgUrl,t.hiddenField&&(t.$el.$("input[name="+t.hiddenField+"]").value=e.imgUrl)),aj.xhr.defaultCallBack(e)},imgBase64Str:null,progress:0,fileName:""}},methods:{onUploadInputChange:function(e){var t,i,a=this,n=e.target;n.files&&n.files[0]&&(t=n.value.split(".").pop(),this.$fileObj=n.files[0],this.$fileName=this.$fileObj.name,this.$fileType=this.$fileObj.type,e=this.$fileObj.size,this.limitSize?(this.isFileSize=e<this.limitSize,this.errMsg="要上传的文件容量过大，请压缩到 "+this.limitSize+"kb 以下"):this.isFileSize=!0,this.limitFileType?(this.isExtName=new RegExp(this.limitFileType,"i").test(t),this.errMsg="根据文件后缀名判断，此文件不能上传"):this.isExtName=!0,function(a){var n=this,e=new FileReader;e.onload=function(e){if(n.imgBase64Str=e.target.result,n.isImgUpload){var t,i=new Image;for(t in i.onload=function(){307200<a.size&&aj.img.compress(i,n),i.width>n.imgMaxWidth||i.height>n.imgMaxHeight?(n.isImgSize=!1,n.errMsg="图片大小尺寸不符合要求哦，请裁剪图片重新上传吧~"):n.isImgSize=!0},i.src=n.imgBase64Str,o)if(~n.imgBase64Str.indexOf(o[t]))return void(n.isExtName=!0);n.errMsg="亲，改了扩展名我还能认得你不是图片哦"}},e.readAsDataURL(a)}.call(this,n.files[0]),this.isImgUpload&&((i=new Image).onload=function(){i.width>a.imgMaxWidth||i.height>a.imgMaxHeight?(a.isImgSize=!1,a.errMsg="图片大小尺寸不符合要求哦，请重新图片吧~"):a.isImgSize=!0}),function(){var e=this.$el.$("input[type=file]").value.split("\\");this.fileName=null===(e=e.pop())||void 0===e?void 0:e.trim()}.call(this))},doUpload:function(){var i=this,e=new FormData;this.$blob?e.append("file",this.$blob,this.$fileName):e.append("file",this.$fileObj);var t=new XMLHttpRequest;t.onreadystatechange=aj.xhr.requestHandler.delegate(null,this.uploadOk_callback,"json"),t.open("POST",this.action,!0),t.onprogress=function(e){var t=0,e=~~(1e3*e.loaded/e.total);t!==(e/=10)&&(t=e),i.progress=t},t.send(e)}}});var o={jpeg:"/9j/4",gif:"R0lGOD",png:"iVBORw"}}();
//# sourceMappingURL=../sourcemap/form.min.js.map
