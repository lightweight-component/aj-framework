<html>

<head>
    <meta charset="utf-8" />
    <title>AJAXJS Web UI Demo</title>
    <link rel="stylesheet" type="text/css" href="../../dist/css/base.css" />
    <link rel="stylesheet" type="text/css" href="../common/demo.css" />
    <link rel="stylesheet" type="text/css" href="../../dist/css/css/arrow-box.css" />

    <link crossorigin="anonymous" integrity="sha384-FckWOBo7yuyMS7In0aXZ0aoVvnInlnFMwCv77x9sZpFgOonQgnBj1uLwenWVtsEj"
        href="https://lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet" />
    <script src="https://lib.baomitu.com/vue/2.6.11/vue.js"></script>
</head>

<body>
    <div class="box">
        <h1>Welcome to AJAXJS Web UI</h1>
        <div>
            <menu>
                <span></span>
            </menu>
            <div class="content">
                <h2>XHR</h2>
                <p>XHR（XMLHttpRequest），就是 AJAX程序。使用更方便的 RESTful API。</p>
                <p>教程：
                    <a href="https://zhangxin.blog.csdn.net/article/details/112789017"
                        target="_blank">https://zhangxin.blog.csdn.net/article/details/112789017</a>
                <pre class="prettyprint">aj.xhr.get (url: string, cb: XHR_Callback, args?: JsonParam, cfg?: XHR_Config); // GET 请求
aj.xhr.post(url: string, cb: XHR_Callback, args?: JsonParam, cfg?: XHR_Config); // POST 表单请求
aj.xhr.put (url: string, cb: XHR_Callback, args?: JsonParam, cfg?: XHR_Config); // PUT 表单请求
aj.xhr.dele(url: string, cb: XHR_Callback, args?: JsonParam, cfg?: XHR_Config); // DLETE 请求</pre>
                <p>各参数定义如下：</p>
                <pre class="prettyprint">/**
* XHR 回调函数
*/
type XHR_Callback = (data: any, xhr?: XMLHttpRequest) => void;

/**
* XHR 请求配置
*/
export interface XHR_Config {
    /**
    * HTTP 请求方法
    */
    method?: string;

    /**
    * XHR 响应结果的类型
    */
    parseContentType?: 'text' | 'xml' | 'json';
}</pre>

                <p>XHR_Callback 回调函数第一个参数为 JSON 或 HTML 文本，第二个参数为 XHR 原生对象（可选的）。在实际使用中，JSON 的情况居多，于是常常声明为 RepsonseResult
                    类型，如</p>
                <img
                    src="https://img-blog.csdnimg.cn/20210118214634348.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3poYW5neGluMDk=,size_16,color_FFFFFF,t_70" />

                <h2>表单提交</h2>
                <p>对于表单，可直接使用 aj.xhr.form(formEl) 绑定表单实现 ajax 提交。该方法自动绑定表单，url 地址取决于 Form 的 action 元素，方法取决于 method
                    元素（这是尊重 HTML 标签的体现）。例如，</p>

                    <pre class="prettyprint"><xmp><form action="." method="${isCreate ? 'POST' : 'PUT'}">
   ……
</form></xmp></pre>

<pre class="prettyprint">aj.xhr.form(document.body.$('form')); // 默认的响应信息

// 或者自定义提交后的回调
aj.xhr.form(document.body.$('form'), (j: RepsonseResult) => {
    if(json.isOk)
        location.assign(json.newlyId);
});

// 加入提交前的拦截器
aj.xhr.form(document.body.$('form'), cb, {
    beforeSubmit : (form: HTMLFormElement, json: JsonParam) => {
        ... 
        return true/fasle;// 返回 false 阻止提交表单
    } 
});</pre>
<p>该过程会自动序列化表单 name/value，然后作为参数发送请求。相比 XHR_Config，配置参数（第三个参数）增加下面配置内容。</p>
<pre class="prettyprint">/**
 * 表单请求的配置参数
 */
export interface XhrFormConfig extends XHR_Config {
    /**
     * 表单中要忽略的字段
     */
    ignoreField?: String;

    /**
     * true 表示为不进行表单验证
     */
    noFormValid?: boolean;

    /**
     * true 表示为启用 Google 防注册机验证
     */
    googleReCAPTCHA?: boolean;

    /**
     * 提交之前的触发的事件
     */
    beforeSubmit?: (form: HTMLFormElement, json: StringJsonParam) => boolean;
}</pre>
           <p>可以忽略表单中某些的字段、支持内建的表单验证器和 Google 防注册机验证，还可以为表单里面的“返回按钮”添加后退的事件处理器。</p>     

           <h2>原理</h2>
           <p>原理详见<a href="https://zhangxin.blog.csdn.net/article/details/112789017" target="_blank">博客文章</a>。</p>
            </div>
            <div class="copyright">
                <div></div>
            </div>
        </div>
    </div>
    <script src="../common/demo.js"></script>
</body>

</html>