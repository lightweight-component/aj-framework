<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <title>spring.xml</title>
    <style>
	</style>
    <link rel="stylesheet" type="text/css" href="../common.css">
    <script src="http://bigfoot.ajaxjs.com/bigfoot/public/run_prettify.js"></script>
  </head>
  <body>
    <p>如果你启用了&nbsp;SSM 项目，要在 web.xml 配置下面内容。</p>
    <pre class="prettyprint">&lt;!-- Spring MVC 接管了所有路径的请求，包括静态文件。于是要把这些例外，交给原来的 Servlet 处理 --&gt;
&lt;servlet-mapping&gt;
	&lt;servlet-name&gt;default&lt;/servlet-name&gt;
	&lt;url-pattern&gt;*.htm&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
&lt;servlet-mapping&gt;
	&lt;servlet-name&gt;default&lt;/servlet-name&gt;
	&lt;url-pattern&gt;*.html&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
&lt;servlet-mapping&gt;
	&lt;servlet-name&gt;default&lt;/servlet-name&gt;
	&lt;url-pattern&gt;*.gif&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
&lt;servlet-mapping&gt;
	&lt;servlet-name&gt;default&lt;/servlet-name&gt;
	&lt;url-pattern&gt;*.png&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
&lt;servlet-mapping&gt;
	&lt;servlet-name&gt;default&lt;/servlet-name&gt;
	&lt;url-pattern&gt;*.jpg&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
&lt;servlet-mapping&gt;
	&lt;servlet-name&gt;default&lt;/servlet-name&gt;
	&lt;url-pattern&gt;*.js&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
&lt;servlet-mapping&gt;
	&lt;servlet-name&gt;default&lt;/servlet-name&gt;
	&lt;url-pattern&gt;*.css&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
&lt;servlet-mapping&gt;
	&lt;servlet-name&gt;default&lt;/servlet-name&gt;
	&lt;url-pattern&gt;*.ico&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
&lt;!-- // --&gt;

&lt;!-- 权限系统 --&gt;
&lt;filter&gt;
	&lt;filter-name&gt;shiroFilter&lt;/filter-name&gt;
	&lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;
	&lt;init-param&gt;
		&lt;param-name&gt;targetFilterLifecycle&lt;/param-name&gt;
		&lt;param-value&gt;true&lt;/param-value&gt;
	&lt;/init-param&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
	&lt;filter-name&gt;shiroFilter&lt;/filter-name&gt;
	&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;
&lt;!-- // --&gt;

&lt;!-- 启动 Spring MVC，需要额外提供 springMVC-servlet.xml 配置 --&gt;
&lt;servlet&gt;
	&lt;servlet-name&gt;springMVC&lt;/servlet-name&gt;
	&lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
	&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
	&lt;servlet-name&gt;springMVC&lt;/servlet-name&gt;
	&lt;url-pattern&gt;/&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
&lt;!-- // --&gt;</pre>
    <p>而且需额外提供 springMVC-servlet.xml。</p>
    <pre class="prettyprint">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans default-lazy-init="true"
    xmlns="http://www.springframework.org/schema/beans" xmlns:p="http://www.springframework.org/schema/p"
    xmlns:tx="http://www.springframework.org/schema/tx" xmlns:aop="http://www.springframework.org/schema/aop"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
    xmlns:mvc="http://www.springframework.org/schema/mvc"
    xmlns:util="http://www.springframework.org/schema/util"
    xsi:schemaLocation="
       http://www.springframework.org/schema/beans 
       http://www.springframework.org/schema/beans/spring-beans-3.1.xsd  
       http://www.springframework.org/schema/mvc 
       http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd   
       http://www.springframework.org/schema/context 
       http://www.springframework.org/schema/context/spring-context-3.1.xsd
       http://www.springframework.org/schema/util
       http://www.springframework.org/schema/util/spring-util-4.2.xsd"&gt;
       
	&lt;!-- 需要使用 @Controller 注解   --&gt;
	&lt;context:component-scan base-package="com.ajaxjs.framework.user, com.ajaxjs.cms.*" /&gt;
		
	&lt;mvc:annotation-driven validator="validator"/&gt;
	
	&lt;!-- 数据验证 Validator bean --&gt;
	&lt;bean id="validator" class="org.springframework.validation.beanvalidation.LocalValidatorFactoryBean"&gt;
	    &lt;property name="providerClass" value="org.apache.bval.jsr.ApacheValidationProvider" /&gt;
	&lt;/bean&gt;
	&lt;!-- // --&gt;

	&lt;!-- &lt;mvc:resources location="/bigfoot/" mapping="/bigfoot/**" /&gt; --&gt;
	&lt;!-- ViewResolver --&gt;
	&lt;bean id="viewResolver"
		class="org.springframework.web.servlet.view.InternalResourceViewResolver"&gt;
		&lt;property name="prefix" value="/WEB-INF/jsp/" /&gt;
		&lt;property name="suffix" value=".jsp" /&gt;
	&lt;/bean&gt;

	&lt;bean class="org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor" /&gt;

	&lt;bean id="securityManager" class="org.apache.shiro.web.mgt.DefaultWebSecurityManager"&gt;
		&lt;property name="realm" ref="shiroDbRealm" /&gt;
	&lt;/bean&gt;

	&lt;bean id="shiroDbRealm" class="com.ajaxjs.framework.service.ShiroDbRealm" /&gt;

	&lt;bean id="captchaFormAuthenticationFilter"
		class="com.ajaxjs.framework.user.captcha.CaptchaFormAuthenticationFilter"&gt;
		&lt;property name="usernameParam" value="name" /&gt;
&lt;!-- 		&lt;property name="passwordParam" value="password" /&gt; --&gt;
&lt;!-- 		&lt;property name="rememberMeParam" value="rememberMe" /&gt; --&gt;
		&lt;property name="loginUrl" value="/service/user/access/login" /&gt;
	&lt;/bean&gt;
	
	&lt;bean id="shiroFilter" class="org.apache.shiro.spring.web.ShiroFilterFactoryBean"&gt;
		&lt;property name="securityManager" ref="securityManager" /&gt;
		&lt;property name="loginUrl" value="/service/user/access/login" /&gt;
		&lt;property name="successUrl" value="/service/user/welcome" /&gt;
		&lt;property name="unauthorizedUrl" value="/service/user/unauthorized" /&gt;
		
		&lt;property name="filters"&gt; 
	      &lt;util:map&gt; 
	         &lt;entry key="authcaptcha" value-ref="captchaFormAuthenticationFilter" /&gt; 
	      &lt;/util:map&gt; 
	   &lt;/property&gt; 
		&lt;property name="filterChainDefinitions"&gt;
			&lt;value&gt;
				/resources/** = anon
				/manageUsers = perms[user:manage]
				/service/user/access/login = authcaptcha
				/admin/** = authc
				/cms/** = authc
				#/** = authc
			&lt;/value&gt;
		&lt;/property&gt;
	&lt;/bean&gt;

	&lt;bean id="lifecycleBeanPostProcessor" class="org.apache.shiro.spring.LifecycleBeanPostProcessor" /&gt;
	&lt;bean class="org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator" <br>              depends-on="lifecycleBeanPostProcessor" /&gt;

	&lt;bean class="org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor"&gt;
		&lt;property name="securityManager" ref="securityManager" /&gt;
	&lt;/bean&gt;
&lt;/beans&gt;</pre>
  </body>
</html>
