<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>表单提示及验证</title>
	<link rel="stylesheet/less" type="text/css" href="../common/widget.less" ／>
	<script src="../common/less.min.js"></script>
	<link rel="stylesheet" type="text/css" href="base.css" />
</head>
<body>

	<script>
		if (!this.FormData) {
			FormData = function () { }
		}
		; (function () {
			// 遍历每个函数
			function getList(formEl, fn) {
				var list = [];
				function add(el) {
					list.push(el);
				}
				var forEach = [].forEach;
				forEach.call(formEl.querySelectorAll('input[type=text]'), add);
				forEach.call(formEl.querySelectorAll('input[type=password]'), add);

				list.forEach(fn);
			}

			function createNoteEl(className, tipsNote, input) {
				var tipsNoteEl = document.createElement('div');
				tipsNoteEl.classList.add(className);
				tipsNoteEl.innerHTML = '<div class="arrow"></div><span>' + tipsNote + '</span>';
				input.parentNode.appendChild(tipsNoteEl); // 添加兄弟节点

				return tipsNoteEl;
			}

			function onfocus(e) {
				var el = e.currentTarget;

				var tipsNote = el.getAttribute('data-note2');
				if (tipsNote) {
					var tipsNoteEl = el.parentNode.querySelector('.tipsNote2');
					tipsNoteEl.querySelector('span').innerHTML = tipsNote;
					//					var xy = el.getBoundingClientRect();
					//					tipsNoteEl.style.left = xy.right + 20 + 'px';
					tipsNoteEl.style.left = el.offsetLeft + el.offsetWidth + 20 + 'px';
					tipsNoteEl.style.top = el.offsetTop + el.offsetTop + 'px';
					tipsNoteEl.classList.remove('hide');
					tipsNoteEl.classList.add('active');
				}
			}

			function onBlur(e) {
				var el = e.currentTarget;

				// 同一时间只有一个 float panel
				var tipsNote = document.querySelector('.tipsNote2.active');
				tipsNote && tipsNote.classList.add('hide');
				tipsNote && tipsNote.classList.remove('active');

				// check
				var iconEl = el.parentNode.querySelector('.icon');
				var xy = el.getBoundingClientRect();
				iconEl.style.left = xy.right + 5 + 'px';
				iconEl.style.top = xy.top + 6 + 'px';

				if (el.hasAttribute('required')) {
					if (el.value) {
						iconEl.classList.remove('hide');
						iconEl.classList.remove('error');
						iconEl.classList.add('pass');
					} else {
						iconEl.classList.remove('hide');
						iconEl.classList.remove('pass');
						iconEl.classList.add('error');
					}
				}

				if (el.hasAttribute('data-regexp')) {
					var validatorReg = {
						require: /.+/,
						username: /^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/,
						email: /^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,
						url: /^http:\/\/[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/,
						integer: /^[-\+]?\d+$/,
						double: /^[-\+]?\d+(\.\d+)?$/,
						english: /^[A-Za-z]+$/,
						chinese: /^[\u0391-\uFFE5]+$/
					};
					var regexp = validatorReg[el.getAttribute('data-regexp')];
					if (!regexp) regexp = new RegExp(regexp); // 预设没有的，自定义
					if (regexp && regexp.test(el.value)) {
						iconEl.classList.remove('hide');
						iconEl.classList.remove('error');
						iconEl.classList.add('pass');
					} else {
						iconEl.classList.remove('hide');
						iconEl.classList.remove('pass');
						iconEl.classList.add('error');
					}
				}
			}

			function everyInput(input) {
				// 说明
				var tipsNote = input.getAttribute('data-note');
				var tipsEl = tipsNote && createNoteEl('tipsNote', tipsNote, input);

				//var data-note-direction = input.getAttribute('data-note-direction');
				//return;

				// float panel
				var tipsNote2 = input.getAttribute('data-note2');
				tipsNote2 && createNoteEl('tipsNote2', tipsNote2, input).classList.add('hide');

				// 表单验证的状态图标
				var iconEl = document.createElement('div');
				iconEl.classList.add('icon');
				iconEl.classList.add('hide');
				input.parentNode.appendChild(iconEl);
				input.onfocus = onfocus;
				input.onblur = onBlur;
			}

			FormData.initTips = function (formEl) {
				getList(typeof formEl == 'string' ? document.querySelector(formEl) : formEl, everyInput);
			}
		})();
	</script>
 

	<form action="?" method="POST" style="width:450px;" class="form-1 ajaxjs-form">

		<dl>
			<label>
				<dt><span class="required-note">*</span>用户名：</dt>
				<dd>
					<input type="text" name="username" placeholder="用户名" 
					required 
					data-regexp="Username"
					data-note="用户名等于账号名；不能与现有的账号名相同；注册后不能修改；"
					data-note2="用户名22等于账号名；不能与现有的账号名相同；注册后不能修改；"
					/>
				</dd>
			</label>
		
		
		<label>
			<dt><span class="required-note">*</span>电子邮件：</dt>
			<dd>				
				<input type="text" name="username" placeholder="请输入电子邮件" 
					data-regexp="email"
					data-note="邮件可用于登录和查找密码等；不能与现有的邮件相同；注册后可以修改；" 
					data-note2="推荐使用国内邮箱，如 QQ、163 等的邮箱" />
			</dd>
		</label>

		<label>
			<dt><span class="required-note">*</span>登录密码 :</dt>
			<dd><input type="password" name="password" /></dd>
		</label>

		<label>
			<dt style="
overflow: hidden;
vertical-align: middle;
display: table-cell;
height: 100px;
line-height: 100px;"><span class="required-note">*</span>个人简介 :</dt>
			<dd><textarea style="width:100%;height:100px;resize:none;"></textarea></dd>
		</label>

		<label>
			<dt><span class="required-note">*</span>确认密码 :</dt>
			<dd><input type="password" name="password" /></dd>
		</label>

		<!-- 验证码 -->
		<label class="captchaCode">
			<dt><span class="required-note">*</span>验证码：</dt>
			<dd><input type="text" data-regexp="integer" required /></dd>
		</label>
		<label>
			<dt>&nbsp;
			</dt>
			<dd>
				<input name="agree" type="checkbox" />
				我已仔细阅读并接受<a href="misc/registration-policy.jsp" target="_blank">注册条款</a>
			</dd>
		</label>
		</dl>

		
	
		<div>
			&nbsp;&nbsp;&nbsp;&nbsp;<input type="submit" value="注 册" /> &nbsp;&nbsp;&nbsp;&nbsp;<a href="?">现有账号登录</a>
		</div>
	</form>

	<div class="single_tips hide">
		<div class="arrow"></div>
		<span></span>
	</div>
	<script>
			FormData.initTips('.form-1');
	</script>

</body>

</html>